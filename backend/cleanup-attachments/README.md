# Cleanup Attachments Function

Автоматическое удаление вложений старше 24 часов из анонимного чата.

## Назначение

Эта функция удаляет (обнуляет URL) всех фото, видео и голосовых сообщений, которые были отправлены более 24 часов назад. Это обеспечивает конфиденциальность пользователей.

## Как работает

1. Функция проверяет таблицу `messages` на наличие записей с `photo_url IS NOT NULL`
2. Все записи старше 24 часов обнуляются (устанавливается `photo_url = NULL`)
3. Возвращается количество очищенных записей

## Использование

### Ручной запрос

```bash
curl https://functions.poehali.dev/44deba1f-2392-4866-9015-8df267216a6c
```

### Автоматический запуск (рекомендуется)

Настройте cron-задачу для вызова функции каждый час:

```bash
0 * * * * curl -X GET https://functions.poehali.dev/44deba1f-2392-4866-9015-8df267216a6c
```

Или используйте внешний сервис для планирования (например, cron-job.org):
- URL: `https://functions.poehali.dev/44deba1f-2392-4866-9015-8df267216a6c`
- Интервал: каждый час
- Метод: GET

## Ответ

```json
{
  "deleted_count": 42,
  "timestamp": "NOW()"
}
```

- `deleted_count` - количество очищенных записей
- `timestamp` - время выполнения операции

## Автоматическая очистка при просмотре

Также очистка автоматически запускается при открытии вкладки "Вложения" в админ-панели. Поэтому даже без настройки cron старые файлы будут удаляться при каждом посещении админ-панели.
